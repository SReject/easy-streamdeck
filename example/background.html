<!DOCTYPE html>
<html lang="en">
    <head>
        <title>easy-streamdeck - Plugin Example</title>
        <meta charset="utf-8">
        <script src="./easy-streamdeck.js"></script>
    </head>
    <body>
        <script>
        let settingsCache = {};

        streamdeck.on('streamdeck:button:appear', function (evt) {
            let context = evt.data,
                keyPressCounter = 0;

            if (context.settings != null && context.settings.hasOwnProperty('keyPressCounter')) {
                keyPressCounter = context.settings.keyPressCounter;
            }

            settingsCache[context.uuid] = {'keyPressCounter': keyPressCounter};
            context.setTitle("" + keyPressCounter);
        });

        streamdeck.on('streamdeck:keypress:up', function (evt) {

            let context = evt.data,
                keyPressCounter,
                updatedSettings;

            keyPressCounter = 0;

            if (context.settings != null && context.settings.hasOwnProperty('keyPressCounter')) {
                keyPressCounter = context.settings.keyPressCounter;
            }

            keyPressCounter++;
            keyPressCounter = keyPressCounter % 10;

            updatedSettings = {'keyPressCounter': keyPressCounter};
            settingsCache[context.uuid] = updatedSettings;

            context.setSettings(updatedSettings);
            context.setTitle("" + keyPressCounter);

        });

        streamdeck.register('getnumbervalue', function (context) {
            if (
                settingsCache[context.uuid] == null ||
                settingsCache[context.uuid].keyPressCounter == null
            ) {
                return 0;
            }

            return settingsCache[context.uuid].keyPressCounter;
        });

        streamdeck.on("streamdeck:notify:setvalue", function (evt) {
            let context = evt.data.context,
                newValue = evt.data.data;

            if (settingsCache[context.uuid] == null) {
                settingsCache[context.uuid] = {};
            }

            settingsCache[context.uuid].keyPressCounter = newValue;

            context.setSettings({'keyPressCounter': newValue});
            context.setTitle("" + newValue);
        });

        streamdeck.on("streamdeck:notify:setbackground", function (evt) {
            let context = evt.data.context,
                imageName = evt.data.data;

            context.setImageFromUrl(`./icons/${imageName}.png`);
        });
        </script>
    </body>
</html>